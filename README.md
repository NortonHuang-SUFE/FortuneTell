# FortuneTell - 智能命理分析系统

## 项目简介

FortuneTell 是一个基于人工智能的命理分析系统，结合了八字命理和紫微斗数两大传统命理体系，通过多智能体协作的方式为用户提供全面、专业的命理分析服务。系统采用先进的 AI 模型，能够理解用户的自然语言问题，并提供专业的命理分析和建议。

## 核心特点

- 🤖 **多智能体协作**：系统由多个专业智能体组成，分别负责八字分析、紫微斗数分析和综合总结
- 📊 **双命理体系**：同时运用八字命理和紫微斗数两大传统命理体系进行分析
- 🔍 **深度分析**：基于用户提供的出生信息，进行详细的命盘解读和运势分析
- 💡 **智能交互**：支持自然语言提问，系统能够理解并针对性地回答各类命理问题
- 📝 **专业输出**：提供结构化的分析结果，包含详细解读和简明总结
- 🔄 **实时响应**：支持异步处理和实时消息推送
- 📈 **可扩展性**：模块化设计，易于添加新的分析维度和功能

## 技术架构

- **后端框架**：Flask
- **AI 模型**：
  - 通义千问：用于八字分析和紫微斗数分析
  - DeepSeek：用于深度分析和推理
  - 智谱 AI：用于综合总结和结论生成
- **异步处理**：asyncio
- **消息处理**：自定义消息处理系统，支持多种消息类型
- **日志系统**：完整的日志记录，支持中文输出
- **API 接口**：RESTful API 设计，支持异步任务处理

## 快速开始

1. **安装依赖**
```bash
pip install -r requirements.txt
```

2. **配置 API 密钥**
在 `config.py` 中配置相应的 API 密钥：
- 通义千问 API 密钥
- DeepSeek API 密钥
- 智谱 AI API 密钥

3. **启动服务**
```bash
python app.py
```

4. **使用方式**
- 通过 API 接口提交分析请求
- 提供出生信息（年、月、日、时、性别等）
- 提出具体问题（如事业、感情、财运等）
- 获取专业的命理分析结果

## API 接口

### 启动分析任务
```
POST /start-task
Content-Type: application/json

{
    "task": "用户是北京时间1996年1月1日0:31【24小时制】出生在重庆永川的男生，今天是2025年4月15日，想要知道【我的直系领导什么时候能够被调走】"
}
```

响应：
```json
{
    "task_id": "uuid",
    "status": "started",
    "message": "任务已启动"
}
```

### 获取分析结果
```
GET /get-latest?task_id=<task_id>
```

响应：
```json
{
    "status": "running|completed|failed",
    "messages": [
        {
            "type": "ToolCallExecutionEvent",
            "source": "agentBazi",
            "message": {
                "性别": "男",
                "真太阳时": "1995年12月31日 23:47",
                "命宫": "辛巳",
                "胎元": "己卯",
                "四柱": "乙亥 戊子 丙申 庚子",
                "五行分数": "{'金': 10, '木': 8, '水': 31, '火': 5, '土': 6}",
                "五行总结": "13, 通常>29为强，需要参考月份、坐支等",
                "格局分析": {
                    "调候": "1壬2己戊",
                    "格局选用": "食伤生财：无用 财格： 印格： 杀印相生： 官杀：无印凶有印贵 伤官配印：",
                    "命宫分析": "巳 天文星、文章振发、女命有好夫。",
                    "坐支分析": "身坐财，庚寅时贵，癸巳时亦吉"
                }
            }
        }
    ]
}
```

## 消息处理规范

系统采用标准化的消息处理机制，支持以下消息类型：

- **ToolCallRequestEvent**：工具调用请求，包含调用参数
- **ToolCallExecutionEvent**：工具执行结果，包含分析数据
- **TextMessage**：最终分析结果，包含详细解读

消息格式：
```json
{
    "type": "消息类型",
    "source": "消息来源",
    "message": {
        "params": "参数信息",
        "main_response": "主要响应",
        "summary": "总结信息"
    }
}
```

## 注意事项

1. 请确保提供准确的出生时间和地点信息
2. 系统支持阳历和阴历输入
3. 分析结果仅供参考，请理性对待
4. 建议在专业命理师的指导下使用
5. 请合理使用 API 资源，避免频繁请求
6. 注意保护个人隐私信息

## 开发计划

- [ ] 添加更多命理分析维度
- [ ] 优化消息处理机制
- [ ] 增加缓存机制
- [ ] 添加用户认证系统
- [ ] 开发 Web 界面
- [ ] 支持更多 AI 模型

## 贡献指南

欢迎提交 Issue 和 Pull Request 来帮助改进项目。在提交代码前，请确保：

1. 代码符合项目的编码规范
2. 添加必要的测试用例
3. 更新相关文档
4. 提供清晰的提交信息

## 许可证

MIT License

## 联系方式

如有问题或建议，请通过以下方式联系：

- 提交 Issue
- 发送邮件至 [your-email@example.com]
- 加入我们的讨论群
